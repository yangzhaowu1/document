# 常用关键字
# 十一、常用关键字

## 1、for和range

在Go的for…range循环中，Go始终使用值拷贝的方式代替被遍历的元素本身，简单来说，就是for…range中那个value，是一个值拷贝，而不是元素本身。这样一来，当我们期望用&获取元素的地址时，实际上只是取到了value这个临时变量的地址，而非list中真正被遍历到的某个元素的地址。而在整个for…range循环中，value这个临时变量会被重复使用，

range 循环，Go 语言都会在编译期将原切片或者数组赋值给一个新变量 `ha`，在赋值的过程中就发生了拷贝，而我们又通过 `len` 关键字预先获取了切片的长度，所以在循环中追加新的元素也不会改变循环执行的次数

## 2、defer

在当前**函数返回**前执行传入的函数，常用于关闭文件描述符、关闭数据库连接以及解锁资源等

- defer的调用时机（函数返回）以及多次调用的执行顺序（栈）
- defer关键字使用传值的方式传递参数时会进行预计算：使用匿名函数避免
- 函数和参数表达式会在语句执行时求值，实际调用推迟到函数返回

### 2.1、数据结构

```go
type _defer struct {
	siz       int32
	started   bool
	openDefer bool
	sp        uintptr
	pc        uintptr
	fn        *funcval
	_panic    *_panic
	link      *_defer
}
```

runtime.defer

## 3、panic、recover

- panic:改变程序的控制流，立即停止执行当前函数的剩余代码，并在当前goroutine中递归执行defer
- recover：终止panic造成的程序崩溃，只能于defer函数中发挥作用

## 4、make、new

new(T) 返回 T 的指针 *T 并指向 T 的零值。

make(T) 返回的初始化的 T，只能用于 slice，map，channel。map，slice，channel 通过函数穿参之后在函数内部修改将影响函数外部的值。

## 5、select

- 无default时会阻塞知道有一个分支满足
- 如果多种情况满足，随机选择一个
- 有default时，为非阻塞的，所有分支都不满足则，直接执行default（switch同理）